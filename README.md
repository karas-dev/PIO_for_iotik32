# Инструкция по настройке PlatformIO IDE для плат IoTik32
Это - небольшое руководство по началу работы с платой IoTik32 в PlatformIO.
Почему PlatformIO?
- Компилятор компилирует тяжёлое ядро ESP32 **только один раз** при изменении *platformio.ini* или перемеещении папки проекта. В остальных случах он компилирует только изменённые файлы.
- Более 1000 поддерживаемых плат (напр. STM32, Raspberry Pi Pico
## 1. Установка программ
Примечание. Все установочные файлы Вы можете скачать с [Яндекс Диска](https://disk.yandex.ru/d/Xpqp5QF5ZPTfwg), но рекомендуется скачивать с официальных сайтов, там могут быть более новые версии.
### Visual Studio Code (далее - VS Code)
Visual Studio Code можно скачать с [официального сайта](https://code.visualstudio.com/)
> [!WARNING]
> Внимание! VS Code поддерживает Windows только 10/11 64-битную версию!

> [!TIP]
> про MacOS и Linux читать [здесь](https://code.visualstudio.com/Download)
  
  
  
При установке необходимо поставить следющие две галочки:
![](https://alexgyver.ru/wp-content/uploads/2024/11/image-1732811658691.png)

### PlatformIO (далее - PIO)
В VS Code зайдите в раздел "Расширения", в поиске ввести "PlatformIO" и установить расширение. Могут появится уведомления о безопасности - соглашаемся.

![](https://alexgyver.ru/wp-content/uploads/2024/11/pio-2.png)

После установки перезапускаем VS Code

![](https://github.com/karas-dev/PIO_for_iotik32/blob/main/img/Снимок%20экрана%202026-01-27%20183800.png))

### Git
Для работы с ESP32 необходимо установить Git. [Скачиваем его](https://git-scm.com/install/)

Запускаем файл, соглашаемся с условиями, выбираем редактор Visual Studio Code, ожидаем распаковки.

![](https://github.com/karas-dev/PIO_for_iotik32/blob/main/img/GIT_Install_page1.png)

![](https://github.com/karas-dev/PIO_for_iotik32/blob/main/img/GIT_install_setEditor.png)

![](https://github.com/karas-dev/PIO_for_iotik32/blob/main/img/GIT_installed.png)

### Другие расширения (необязательно)
Все расширения скачиваем из менеджера расширений (дополнений)

**Serial Monitor** - удобный монитор порта

**Russian Language Pack for Visual Studio Code** - русификатор (некоторые настройки всё равно не переведены)

**PlatformIO Big Buttons** - крупные и удобные кнопки компиляции, загрузки (находятся в  разделе "Проводник")


## Немного о структуре проекта
в PIO проект - это папка. В ней:
- platformio.ini (файл настройки проекта)
- Папка `src` - в ней лежит `main.cpp` (главный файл) и прочие файлы кода как в Arduino IDE
- Папка `lib` - также файлы проекта, библиотеки
- Папки `.pio` и `.vscode` - папки, где хранятся системные файлы
Для начала можно **добавить [пример](https://disk.yandex.ru/d/4AFAn3C03TVvbA)**
![](https://github.com/karas-dev/PIO_for_iotik32/blob/main/img/AddFolderToWorkspace.png)
## Настройки проекта
В PIO все настройки задаются в текстовом файле (Подробнее - на [официальном сайте](https://docs.platformio.org/en/latest/projectconf/index.html)).  
В начале идёт `env` - общие настройки для всех плат

```
[env]
framework = arduino ; Фреймворк - Ардуино
monitor_speed = 115200 ; Скорости монитора порта PIO (не расширения Serial Monitor)
lib_deps =
    FastLED/FastLED ; Подключенные библиотеки с GitHub (об этом позже)
```

Дальше идут `[env:имя_платы]`:
```
[env:iotik32] 
platform = https://github.com/pioarduino/platform-espressif32/releases/download/stable/platform-espressif32.zip ; платформа - ESP32
board = esp32dev ; плата
monitor_filters = esp32_exception_decoder
board_build.filesystem = littlefs
board_build.f_cpu = 240000000L
```
## Особенности языка
В Arduino IDE есть некоторые упрощения C++, которых нету в PIO. Но при этом в PIO тоже можно использовать Arduin-фреймворк (те же `digitalWrite` и прочие команды, т. е. аббсолютно как в Arduino IDE)
### include <Arduino.h>
В скетч обязательно нужно подключить библиотеку `Arduino.h`
### Объявление функций
Функцию нельзя использовать до её объявления:
```
sum(a1, 2); // Так нельзя!
int sum(int a , int b){
    ...
}
```
Но можно объявить функцию в начале, а потом уже определить её действия (Arduino IDE делает это скрытно сама):
```
int sum(int a, int b);
sum(1, 2);
int sum(int a, int b){
    ...
}
```

### Глобальный define
Вы можете добавить `build_flags` в `platformio.ini`:
```
build_flags =
    DEBUG_MODE
    MY_CONST=1
    MY_VERSION="1.0.0"
```
Также префикс `-D` делвет это видимым во всех файлах проекта (в т. ч. и библиотеках)
```
build_flags =
    -D DEBUG_MODE
    -D MY_CONST=1
    -D MY_VERSION="1.0.0"
```
## Компиляция и загрузка
Если скачать расширение "PlatformIO Big Buttons", нужно нажать соотв. синию кнопку.  
В ином случае, можно нажать кннопки внизу окна.  
В любом случае выберите плату в меня плат (не перепутайте проекты!) и COM-порт (по умолчанию стоит `auto` -  PIO просканирует все возможные варианты и выберет подходящий; может произойти конфликт)  
Если выбрать плату `default` будет выполнена компиляция для всех плат, загрузка завершится с **ошибкой**

![](https://github.com/karas-dev/PIO_for_iotik32/blob/main/img/Снимок%20экрана%202026-02-01%20111243.png)

> [!NOTE]
> Повторная компиляция ядра происходит:
> - При перемещении папки проекта
> - При изменении файла `platformio.ini`

Скомпилированный файл проекта в формате *.elf* (код на Ассемблере) и *.bin* (бинарник, файл в двоичном состоянии для загрузки) хранится в `папка_проекта\.pio\build\имя_платы`
## Монитор порта
В PIO есть встроенный монитор порта, но он обладает ограниченными возможностями, и иногда просто не работает. Именно его скорость задаётся в `platformio.ini`
Для его запуска нажмите значок с вилкой в низу окна или нажмите синююю кнопку с монитором

Также есть расширение "Serial Monitor" - в нём есть:
- выбор COM-порта
- установка скорости
- установка символа окончания строки
- и другое
> [!CAUTION]
> Не забудьте остановить монитор порта перед загрузкой!
## Подключение библиотек
### С GitHub
Если у библиотеки в описании (`README.md`) есть ![значок PIO](https://github.com/karas-dev/PIO_for_iotik32/blob/main/img/Снимок%20экрана%202026-02-01%20122627.png), в `lib_deps` пишем `<автор_библиотеки>/<имя_репозитория_с_библиотекой>`, например `GyverLibs/GyverHub`.
Если же библиотека не имеет такого значка, ставим в `lib_deps` URL до ZIP-архива с исходником (релиза)
### С других Git-хранилищ (GitVerse, SourceCraft и т. п.)
Копируем ссылку на архив/релиз и вставляем в `lib_deps`
### ZIP-архивом ил просто папкой с кодом
1. Если архив - распаковываем
2. Дальше кладём папку/распакованый архив в `lib` или `src`
3. В `platformio.ini` менять ничего не надо - только добавляем `#include` куда надо
> [!TIP]
> Компилятор компилирует **все вложенные/прикрепленные файлы**, так что много фалов хранить не советуется!
# Подробности
Подробную информацию можно найти в
- Официальной документации ([docs.platformio.org](https://docs.platformio.org))
- [Статье](https://alexgyver.ru/lessons/platformio/) от AlexGyver
- Других источниках в Интернете
