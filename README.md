# Инструкция по настройке PlatformIO IDE для плат IoTik32
- Папки `.pio` и `.vscode` — папки, где хранятся системные файлы.
Для начала можно **добавить [пример](https://disk.yandex.ru/d/4AFAn3C03TVvbA)**.
![](https://github.com/karas-dev/docs/blob/main/AddFolderToWorkspace.png)
## Настройки проекта
В PIO все настройки задаются в текстовом файле (подробнее — на [официальном сайте](https://docs.platformio.org/en/latest/projectconf/index.html)).  
В начале идёт `env` — общие настройки для всех плат.

```
[env]
framework = arduino ; Фреймворк — Ардуино
monitor_speed = 115200 ; Скорости монитора порта PIO (не расширения Serial Monitor)
lib_deps =
    FastLED/FastLED ; Подключенные библиотеки с GitHub (об этом позже)
```

Дальше идут `[env:имя_платы]`:
```
[env:iotik32] 
platform = https://github.com/pioarduino/platform-espressif32/releases/download/stable/platform-espressif32.zip ; платформа — ESP32
board = esp32dev ; плата
monitor_filters = esp32_exception_decoder
board_build.filesystem = littlefs
board_build.f_cpu = 240000000L
```
## Особенности языка
В Arduino IDE есть некоторые упрощения C++, которых нет в PIO. Но при этом в PIO тоже можно использовать Arduino-фреймворк (те же `digitalWrite` и прочие команды, т. е. абсолютно как в Arduino IDE).
### #include <Arduino.h>
В скетч обязательно нужно подключить библиотеку `Arduino.h`.
### Объявление функций
Функцию нельзя использовать до её объявления:
```
sum(1, 2); // Так нельзя!
int sum(int a, int b){
    ...
}
```
Но можно объявить функцию в начале, а потом уже определить её действия (Arduino IDE делает это скрытно сама):
```
int sum(int a, int b);
sum(1, 2);
int sum(int a, int b){
    ...
}
```

### Глобальный define
Вы можете добавить `build_flags` в `platformio.ini`:
```
build_flags =
    DEBUG_MODE
    MY_CONST=1
    MY_VERSION="1.0.0"
```
Также префикс `-D` делает это видимым во всех файлах проекта (в т. ч. и библиотеках):
```
build_flags =
    -D DEBUG_MODE
    -D MY_CONST=1
    -D MY_VERSION="1.0.0"
```
## Компиляция и загрузка
Если скачать расширение "PlatformIO Big Buttons", нужно нажать соотв. синюю кнопку.  
В ином случае можно нажать кнопки внизу окна.  
В любом случае выберите плату в меню плат (не перепутайте проекты!) и COM-порт (по умолчанию стоит `auto` — PIO просканирует все возможные варианты и выберет подходящий; может произойти конфликт).  
Если выбрать плату `default`, будет выполнена компиляция для всех плат, загрузка завершится с **ошибкой**.

![](https://github.com/karas-dev/docs/blob/main/Снимок%20экрана%202026-02-01%20111243.png)

> [!NOTE]
> Повторная компиляция ядра происходит:
> - При перемещении папки проекта
> - При изменении файла `platformio.ini`

Скомпилированный файл проекта в формате *.elf* (код на Ассемблере) и *.bin* (бинарник, файл в двоичном состоянии для загрузки) хранится в `папка_проекта\.pio\build\имя_платы`.
## Монитор порта
В PIO есть встроенный монитор порта, но он обладает ограниченными возможностями и иногда просто не работает. Именно его скорость задаётся в `platformio.ini`.
Для его запуска нажмите значок с вилкой в низу окна или нажмите синюю кнопку с монитором.

Также есть расширение "Serial Monitor" — в нём есть:
- выбор COM-порта
- установка скорости
- установка символа окончания строки
- и другое
> [!CAUTION]
> Не забудьте остановить монитор порта перед загрузкой!
## Подключение библиотек
### С GitHub
Если у библиотеки в описании (`README.md`) есть ![значок PIO](https://github.com/karas-dev/docs/blob/main/Снимок%20экрана%202026-02-01%20122627.png), в `lib_deps` пишем `автор/имя_репозитория`.
Если же библиотека не имеет такого значка, ставим в `lib_deps` URL до ZIP-архива с исходником (релиза).
### С других хабов (GitVerse, SourceCraft и т. п.)
Копируем ссылку на архив/релиз и вставляем в `lib_deps`.
### ZIP-архивом или просто папкой с кодом
1. Если архив — распаковываем
2. Дальше кладём папку/распакованый архив в `lib` или `src`
3. В `platformio.ini` менять ничего не надо — только добавляем `#include` куда надо
> [!TIP]
> Компилятор компилирует **все вложенные/прикрепленные файлы**, так что много фалов хранить не советуется!
# Подробности
Подробную информацию можно найти в
- Официальной документации ([docs.platformio.org](https://docs.platformio.org))
- [Статье](https://alexgyver.ru/lessons/platformio/) от AlexGyver
- Других источниках в Интернете.
